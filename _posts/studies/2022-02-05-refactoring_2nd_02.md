---
title: "(책) 리팩터링 2판 - 4장"
layout: single
author_profile: false
read_time: false
comments: false
share: true
related: true
categories:
  - study
toc: true
toc_sticky: true
toc_labe: 목차
description: '테스트 구축하기'의 내용을 정리합니다.
excerpt: '테스트 구축하기'의 내용을 정리합니다.
tags:
  - book
---

마틴 파울러의 『리팩터링 2판』에 대해 정리하는 목적의 글입니다. 4장의 내용을 담고 있습니다.

## 4. 테스트 구축하기

### 4.1 자가 테스트 코드의 가치

> 테스트 스위트(suite)는 강력한 버그 검출 도구로, 버그를 찾는 데 걸리는 시간을 대폭 줄여준다. - p.134

저자는 자가 테스트를 통해 디버깅 시간을 줄여 생산성을 높인 경험을 계기로, 함수를 몇 개만 작성해도 곧바로 테스트를 추가하는 방식으로 개발을 시작했다고 합니다.

"테스트를 작성하기 가장 좋은 시점은 프로그래밍을 시작하기 전"이라고 언급했는데, 그말대로 테스트를 먼저 작성하게 되면 구현할 기능을 위해 무엇이 필요한지를 미리 고민할 수 있다는 장점이 있습니다. 또한 "구현보다 인터페이스에 집중한다", "코딩이 완료되는 시점(테스트를 모두 통과한 때)을 정확하게 판단할 수 있다"는 것도 있습니다.

### 4.3 첫 번째 테스트

> 각각의 테스트가 실패하는 모습을 최소한 한 번씩은 직접 확인해본다. 이를 위해 내가 흔히 쓰는 방법은 일시적으로 코드에 오류를 주입하는 것이다. - p.141

지금까지 단순히 성공과 실패의 경우의 수만을 작성하는 데 그쳤는데, 앞으로는 코드를 작성한 후 위처럼 실행하는 코드에 오류를 임시로 넣어 테스트하는 방법을 적용해봐야겠다고 느꼈습니다. 그리고 작성 중인 코드를 꾸준히 테스트하고, 하루에 한 번은 전체 테스트를 수행하라는 점도 인상깊었습니다.

### 4.4 테스트 추가하기

> 테스트는 위험 요인을 중심으로 작성해야 한다! 테스트의 목적은 어디까지나 현재 혹은 향후에 발생하는 버그를 찾는 데 있다. 따라서 단순히 필드를 읽고 쓰기만 하는 접근자는 테스트할 필요가 없다. - p.143

저자는 "잘못될까봐 가장 걱정되는 영역을 집중적으로 테스트"하여 노력의 효과를 극대화한다고 했는데, 모든 코드에 대한 테스트보다는 필요한 부분의 테스트에 집중하는 것을 뜻하는 것이라고 생각합니다.

---

두 개의 테스트를 작성한 후 중복을 줄이는 과정을 설명하는 과정에서, 그동안 잘못된 방식으로 하고 있음을 깨달았습니다.

```js
describe("province", function () {
  const asia = new Province(sampleProvinceData());
  it("shortfall", function () {
    expect(asia.shortfall).equal(5);
  });
  it("profit", function () {
    expect(asia.profit).equal(230);
  });
});
```

여기서 잘못된 부분은 `asia` 객체를 불러오는 방식입니다. 이 객체는 지금 공유 객체로 사용되고 있는데, 만약 다른 테스트에서 객체의 값을 수정하면 이후의 테스트에도 영향을 미치게 됩니다.

```js
describe("province", function () {
  let asia;
  beforeEach(function () {
    asia = new Province(sampleProvinceData());
  });
  // ...
});
```

`beforeEach`구문을 테스트 바로 전에 실행하여 asia 객체를 초기화하고, 그에따라 모든 테스트마다 새로운 객체를 사용하게 됩니다. 이렇게 모든 테스트를 독립적으로 구성하여 의도치 않은 테스트 에러를 줄일 수 있습니다.
